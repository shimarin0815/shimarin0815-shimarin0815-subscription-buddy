{% extends "base.html" %}
{% block content %}

<div class="flex items-center justify-between mb-4">
  <div>
    <p class="text-gray-500">今月の合計</p>
    <p class="text-2xl font-bold">{{ monthly_total }} JPY / month</p>
  </div>
  <div>
    <p class="text-gray-500">年間の合計</p>
    <p class="text-2xl font-bold">{{ annual_total }} JPY / year</p>
  </div>
  <a href="{{ url_for('new') }}" class="rounded-2xl px-4 py-2 bg-pink-500 text-white shadow hover:opacity-90">＋ 新規追加</a>
</div>

{% if upcoming or soon_free_end %}
<div class="rounded-2xl border border-pink-200 bg-white p-4 mb-6 shadow-sm">
  <p class="font-semibold mb-2">⏰ {{ urgent_days }}日以内のリマインド</p>
  <ul class="list-disc ml-6 space-y-1">
    {% for s in upcoming %}
      <li>支払い: <b>{{ s.name }}</b> / {{ s.price }} {{ s.currency }}（{{ '月' if s.cycle=='monthly' else '年' }}） / {{ s.next_billing_date }}</li>
    {% endfor %}
    {% for s in soon_free_end %}
      <li>無料終了: <b>{{ s.name }}</b> / {{ s.free_trial_until }}</li>
    {% endfor %}
  </ul>
  <button onclick="requestNotify()" class="mt-3 text-sm underline text-pink-500">ブラウザ通知を有効化</button>
</div>
{% endif %}

<div class="grid gap-3">
  {% for s in subs %}
  <div class="rounded-2xl bg-white p-4 shadow-sm border border-gray-100 hover:shadow-md transition">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="text-lg font-semibold">{{ s.name }}</h3>
        <p class="text-gray-500 text-sm">
          {{ s.price }} {{ s.currency }} / {{ '月' if s.cycle=='monthly' else '年' }}　
          次回: {{ s.next_billing_date }}
          {% if s.free_trial_only %} <span class="ml-2 inline-block px-2 py-0.5 text-xs rounded-full bg-amber-100 text-amber-700">無料期間のみ</span>{% endif %}
          {% if s.free_trial_until %}<span class="ml-2 text-xs text-gray-500">終了: {{ s.free_trial_until }}</span>{% endif %}
        </p>
        {% if s.notes %}<p class="text-sm mt-1 text-gray-600">メモ: {{ s.notes }}</p>{% endif %}
      </div>
      <div class="flex items-center gap-2">
        <a class="rounded-xl px-3 py-1.5 bg-gray-100 hover:bg-gray-200" href="{{ url_for('edit', sid=s.id) }}">編集</a>
        <form method="post" action="{{ url_for('delete', sid=s.id) }}" onsubmit="return confirm('削除しますか？')">
          <button class="rounded-xl px-3 py-1.5 bg-red-50 text-red-700 hover:bg-red-100">削除</button>
        </form>
      </div>
    </div>
  </div>
  {% else %}
  <p class="text-gray-500">まだ登録がありません。右上の「＋新規追加」からどうぞ！</p>
  {% endfor %}
</div>

{% endblock %}
